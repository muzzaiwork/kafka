# 03. Kafka 서버는 몇 대를 운용하는 게 좋을까?

## ✅ 결론 요약
- 초기/개발·테스트 단계, 소규모 트래픽: 1대로 시작해도 무방
- 안정성이 중요한 프로덕션(중견·대기업 등): 최소 3대 이상 권장

운영 목적과 예산, 장애 허용 범위(SLO)에 따라 결정하되, 확장 계획을 미리 세우는 것이 핵심이다.

---

## 1) 초기 스타트업 · PoC · 개발/테스트 단계
- 추천 브로커 수: 1대
- 이유
  - 비용 절감이 최우선이며, 학습/검증 목적에서는 단일 브로커로도 기능 검증 가능
  - 운영 복잡도 낮음(설치/업데이트/모니터링 단순)
- 주의사항
  - 단일 장애 지점(SPOF)으로, 브로커 다운 시 서비스 지연·중단 가능
  - 데이터 내구성과 가용성 요구가 낮은 워크로드에 한정
- 권장 설정/운영 팁
  - 추후 확장을 고려해 토픽·클라이언트 설정(파티션/ACK/타임아웃 등)을 보수적으로 설계
  - 모니터링은 최소한으로라도 구성(디스크/네트워크/프로세스 생존, 프로듀서/컨슈머 오류율)

---

## 2) 안정성이 중요한 프로덕션 환경
- 추천 브로커 수: 최소 3대 이상(가능하면 홀수: 3/5)
- 이유
  - 고가용성(High Availability) 확보: 노드 1대 장애 시에도 지속 운영 가능
  - 리더 선출/메타데이터 합의에 유리(홀수 권장)
  - 유지보수(롤링 업그레이드) 동안에도 서비스 지속
- 권장 설정/운영 팁
  - Replication Factor(RF): 3 권장(장애 복원력 향상)
  - Min In-Sync Replicas(min.insync.replicas): 2 권장(리더 + 최소 1 팔로워 동기화 요구)
  - Producer acks: all(-1) 권장(내구성 강화)
  - 가용 영역(Availability Zone) 분산 배치로 동일 장애 도메인 회피
  - 모니터링/알림 체계: Consumer Lag, ISR 변동, 리더 전환, 디스크 사용량, 네트워크 지연

---

## 3) 선택 시 고려해야 할 체크리스트
- 비즈니스 요구사항
  - RTO/RPO, 허용 다운타임, 데이터 손실 허용 여부
- 트래픽 특성
  - TPS, 피크 패턴, 메시지 크기, 파티션 수(확장성)
- 인프라 제약
  - 예산, AZ/리전 구성, 네트워크 대역폭, 디스크 IOPS
- 운영 난이도
  - 배포/업그레이드 전략, 백업/아카이브 정책, 스케일링 계획(브로커 증설/축소)

---

## 4) 권장 성장 전략(실용 가이드)
1. 1대로 시작(개발/테스트) → 기본 기능/운영 체계 학습
2. 트래픽·가용성 요구가 커지면 3대로 확장
   - 핵심 토픽 RF=3, min.insync.replicas=2 적용
   - 모니터링/알림과 장애 대응 플레이북 준비
3. 성장에 따라 5대 이상 확장 및 AZ/리전 다중화 검토

---

## 참고
- 리더·팔로워, 레플리케이션과 ISR 개념은 [리플리케이션과 ISR](./Architecture.md#replication) 문서를 참고
- 컨슈머 지연(Lag) 모니터링은 [컨슈머 랙(Consumer Lag)](../04-producer-consumer/Consumer-Lag.md) 문서를 참고
