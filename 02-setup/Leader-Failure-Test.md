# [μ‹¤μµ] λ¦¬λ” νν‹°μ…μ— μ¥μ• κ°€ λ°μƒν•λ©΄ μ–΄λ–»κ² λ κΉ?

μΉ΄ν”„μΉ΄μ ν•µμ‹¬ κΈ°λ¥ μ¤‘ ν•λ‚μΈ **κ³ κ°€μ©μ„±(High Availability)**μ„ μ‹¤μ λ΅ μ²΄ν—ν•΄λ³Έλ‹¤. λ¦¬λ” νν‹°μ…μ΄ μλ” λ…Έλ“μ— μ¥μ• κ°€ λ°μƒν–μ„ λ•, ν΄λ¬μ¤ν„°κ°€ μ–΄λ–»κ² μλ™μΌλ΅ λ€μ²ν•κ³  μ„λΉ„μ¤λ¥Ό μ§€μ†ν•λ”μ§€ ν™•μΈν•λ‹¤.

---

## β… κ°μ”

μ΄μ „ μ•„ν‚¤ν…μ² κ°•μμ—μ„ λ‹¤μκ³Ό κ°™μ΄ ν•™μµν–λ‹¤.
> λ¦¬λ” νν‹°μ…μ— μ¥μ• κ°€ λ°μƒν•λ©΄ ν”λ΅μ› νν‹°μ…μ΄ λ¦¬λ” μ—­ν• (ν”„λ΅λ“€μ„λ΅λ¶€ν„° λ©”μ‹μ§€λ¥Ό λ°›κ³ , μ»¨μλ¨Έκ°€ λ©”μ‹μ§€λ¥Ό μ²λ¦¬)μ„ λ€μ‹  μν–‰ν•λ‹¤.

μ‹¤μ λ΅ λ…Έλ“ ν•λ‚λ¥Ό κ°•μ λ΅ μΆ…λ£μ‹μΌμ„ μ΄ κ³Όμ •μ΄ μ–΄λ–»κ² μΌμ–΄λ‚λ”μ§€, κ·Έλ¦¬κ³  μ„λΉ„μ¤κ°€ μ¤‘λ‹¨ μ—†μ΄ μ μ§€λλ”μ§€ μ‹¤μµν•΄λ³Έλ‹¤.

---

## β… μ‹¤μµ κ³Όμ •

### 1. ν„μ¬ λ¦¬λ” λ…Έλ“ ν™•μΈ
`email.send` ν† ν”½μ λ¦¬λ”κ°€ λ„κµ¬μΈμ§€ ν™•μΈν•λ‹¤.

```bash
$ bin/kafka-topics.sh \
    --bootstrap-server localhost:9092 \
    --describe \
    --topic email.send
```

**[μ‹¤ν–‰ κ²°κ³Ό μμ‹]**
```text
Topic: email.send  Partition: 0  Leader: 1  Replicas: 1, 2, 3  Isr: 1, 2, 3
```
* μ„ μμ‹μ—μ„λ” **λ…Έλ“ 1(9092)**μ΄ λ¦¬λ”λ‹¤.

### 2. λ¦¬λ” λ…Έλ“ κ°•μ  μΆ…λ£
λ¦¬λ” μ—­ν• μ„ μν–‰ μ¤‘μΈ λ…Έλ“μ ν„°λ―Έλ„λ΅ κ°€μ„ `Ctrl + C`λ¥Ό λλ¬ ν”„λ΅μ„Έμ¤λ¥Ό μΆ…λ£ν•λ‹¤. (λ…Έλ“ 1 μ¥μ•  λ°μƒ κ°€μ •)

### 3. λ¦¬λ” μΉκ²© λ° μƒνƒ ν™•μΈ
λ…Έλ“ 1μ΄ μΆ…λ£λμ—μΌλ―€λ΅, μ‚΄μ•„μλ” λ‹¤λ¥Έ λ…Έλ“(μ: 19092)λ¥Ό ν†µν•΄ ν† ν”½ μƒνƒλ¥Ό λ‹¤μ‹ μ΅°νν•λ‹¤.

```bash
$ bin/kafka-topics.sh \
    --bootstrap-server localhost:19092 \
    --describe \
    --topic email.send
```

**[μ‹¤ν–‰ κ²°κ³Ό μμ‹]**
```text
Topic: email.send  Partition: 0  Leader: 2  Replicas: 1, 2, 3  Isr: 2, 3
```
* **Leaderκ°€ 2λ΅ λ³€κ²½**: λ¦¬λ”μ€λ 1λ² λ…Έλ“κ°€ λΉ μ§€κ³ , ν”λ΅μ›μ€λ 2λ² λ…Έλ“κ°€ μƒλ΅μ΄ λ¦¬λ”λ΅ μΉκ²©λμ—λ‹¤.
* **Isrμ—μ„ 1λ² μ μ™Έ**: μ¥μ• κ°€ λ°μƒν• 1λ² λ…Έλ“λ” λ™κΈ°ν™” λ©λ΅(ISR)μ—μ„ μλ™μΌλ΅ μ μ™Έλμ—λ‹¤.

### 4. μ¥μ•  μƒνƒμ—μ„ μ„λΉ„μ¤ ν…μ¤νΈ
μ„λ²„ 1λ€κ°€ κ³ μ¥ λ‚¬μ§€λ§, λ‚¨μ€ μ„λ²„λ“¤μ„ ν†µν•΄ μ •μƒμ μΌλ΅ λ©”μ‹μ§€λ¥Ό μ£Όκ³ λ°›μ„ μ μλ”μ§€ ν™•μΈν•λ‹¤.

```bash
# μƒλ΅μ΄ λ¦¬λ”(19092)λ¥Ό ν†µν•΄ λ©”μ‹μ§€ μ „μ†΅
$ bin/kafka-console-producer.sh \
    --bootstrap-server localhost:19092 \
    --topic email.send
> test-message-after-fail

# λ©”μ‹μ§€ μ΅°ν
$ bin/kafka-console-consumer.sh \
    --bootstrap-server localhost:19092 \
    --topic email.send \
    --from-beginning
```
* μ„λ²„ 1λ€κ°€ λ‹¤μ΄λμ—μμ—λ„ λ¶κµ¬ν•κ³  λ©”μ‹μ§€ μƒμ‚°κ³Ό μ†λΉ„κ°€ **μ¤‘λ‹¨ μ—†μ΄ κ°€λ¥ν•¨**μ„ ν™•μΈν•  μ μλ‹¤.

### 5. μ¥μ•  λ…Έλ“ λ³µκµ¬ λ° λ™κΈ°ν™”
μΆ…λ£ν–λ λ…Έλ“λ¥Ό λ‹¤μ‹ μ‹¤ν–‰ν•μ—¬ ν΄λ¬μ¤ν„°μ— λ³µκ·€μ‹ν‚¨λ‹¤.

```bash
# λ…Έλ“ 1 μ¬μ‹μ‘
$ bin/kafka-server-start.sh config/server.properties
```

### 6. λ³µκµ¬ μ™„λ£ ν™•μΈ
λ‹¤μ‹ ν† ν”½ μ •λ³΄λ¥Ό μ΅°νν•μ—¬ 1λ² λ…Έλ“κ°€ ISRμ— λ³µκ·€ν–λ”μ§€ ν™•μΈν•λ‹¤.

```bash
$ bin/kafka-topics.sh \
    --bootstrap-server localhost:19092 \
    --describe \
    --topic email.send
```
**[μ‹¤ν–‰ κ²°κ³Ό μμ‹]**
```text
Topic: email.send  Partition: 0  Leader: 2  Replicas: 1, 2, 3  Isr: 2, 3, 1
```
* `Isr` λ©λ΅μ— λ‹¤μ‹ **1**μ΄ ν¬ν•¨λμ—λ‹¤λ©΄, μ¥μ•  κΈ°κ°„ λ™μ• μ“μ€λ λ°μ΄ν„°λ¥Ό λ¨λ‘ λ³µμ (λ™κΈ°ν™”)ν•μ—¬ μ •μƒ μƒνƒλ΅ λμ•„μ¨ κ²ƒμ΄λ‹¤.

---

## β… κ²°κ³Ό ν•΄μ„ λ° μ •λ¦¬

μ‹¤μµμ„ ν†µν•΄ μΉ΄ν”„μΉ΄κ°€ μ¥μ•  μƒν™©μ—μ„λ„ μ–΄λ–»κ² μ‹μ¤ν…μ„ μ μ§€ν•λ”μ§€ ν™•μΈν–λ‹¤.

1. **μλ™ λ¦¬λ” μ„ μ¶**: λ¦¬λ” λ…Έλ“μ— μ¥μ• κ°€ μƒκΈ°λ©΄ ν΄λ¬μ¤ν„°κ°€ μ¦‰μ‹ ν”λ΅μ› μ¤‘ ν•λ‚λ¥Ό μƒ λ¦¬λ”λ΅ μΉκ²©μ‹ν‚¨λ‹¤.
2. **μ„λΉ„μ¤ κ°€μ©μ„± μ μ§€**: ν”„λ΅λ“€μ„μ™€ μ»¨μλ¨Έλ” ν΄λ¬μ¤ν„°μ λ³€ν™”λ¥Ό μλ™μΌλ΅ κ°μ§€ν•μ—¬ μƒλ΅μ΄ λ¦¬λ”μ™€ ν†µμ‹ ν•λ―€λ΅ μ„λΉ„μ¤ μ¥μ• λ¥Ό μλ°©ν•  μ μλ‹¤.
3. **λ°μ΄ν„° λ³µκµ¬**: μ¥μ•  λ…Έλ“κ°€ λ³µκµ¬λλ©΄ μλ™μΌλ΅ λ¦¬λ”μ λ°μ΄ν„°λ¥Ό λ”°λΌμ΅μ•„(Synchronization) λ‹¤μ‹ κ³ κ°€μ©μ„± κ·Έλ£Ή(ISR)μ— ν•©λ¥ν•λ‹¤.

μ΄κ²ƒμ΄ λ°”λ΅ μΉ΄ν”„μΉ΄κ°€ λ€κ·λ¨ μ‹μ¤ν…μ—μ„ **μ‹ λΆ°ν•  μ μλ” λ°μ΄ν„° ν”λ«νΌ**μΌλ΅ μ„ νƒλ°›λ” ν•µμ‹¬ μ΄μ μΈ **κ³ κ°€μ©μ„±(High Availability)**μ μ‹¤μ²΄λ‹¤.

---

## π“ μ¥μ•  μ΅°μΉ(Failover) μ‹κ°ν™”

```mermaid
sequenceDiagram
    participant P as ν”„λ΅λ“€μ„
    participant N1 as λ…Έλ“ 1 (λ¦¬λ”)
    participant N2 as λ…Έλ“ 2 (ν”λ΅μ›)
    
    Note over N1: μ¥μ•  λ°μƒ (Down)
    N2->>N2: μƒλ΅μ΄ λ¦¬λ”λ΅ μΉκ²©
    Note over N2: Leader: 2
    P->>N2: λ©”μ‹μ§€ μ „μ†΅ (μλ™ λ¦¬λ‹¤μ΄λ ‰μ…)
    Note over N2: μ •μƒ μ²λ¦¬
    
    Note over N1: λ…Έλ“ λ³µκµ¬ (Up)
    N1->>N2: λ°μ΄ν„° λ™κΈ°ν™” μ”μ²­
    N2-->>N1: λ„λ½λ λ°μ΄ν„° λ³µμ 
    Note over N1: ISR ν•©λ¥ μ™„λ£
```
